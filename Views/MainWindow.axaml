<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:Alkitab.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:dialogHost="clr-namespace:DialogHostAvalonia;assembly=DialogHost.Avalonia"
        xmlns:views="clr-namespace:Alkitab.Views"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="Alkitab.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/bible.ico"
        Background="#474747"
        MinWidth="1024" MinHeight="420"
        Title="Alkitab">
    <!-- Opened="OnWindowOpened" -->

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
            to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Window.Styles>
        <Style Selector="ListBox.ScrollBible > ListBoxItem">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Cursor" Value="Hand" />

            <!-- <Setter Property="Template"> -->
            <!--     <ControlTemplate> -->
            <!--         <Border Background="{TemplateBinding Background}"> -->
            <!--             ~1~ This ensures that the ItemTemplate is rendered @1@ -->
            <!--             <ContentPresenter Content="{TemplateBinding Content}" -->
            <!--                               ContentTemplate="{TemplateBinding ContentTemplate}" /> -->
            <!--         </Border> -->
            <!--     </ControlTemplate> -->
            <!-- </Setter> -->
        </Style>

        <!-- Style for selected ListBoxItem -->
        <Style Selector="ListBoxItem:selected">
            <!-- <Setter Property="Background" Value="Gray" /> -->
            <!-- <Setter Property="BorderBrush" Value="Black" /> -->
            <!-- <Setter Property="BorderThickness" Value="2" /> -->
        </Style>

        <!-- Style for pointerover ListBoxItem -->
        <Style Selector="ListBoxItem:pointerover">
            <Setter Property="Background" Value="Gray" />
        </Style>
        
        <Style Selector="views|ToolBox">
            <Setter Property="Height" Value="0"></Setter>
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Height" Duration="0:0:0.2" Easing="SineEaseIn"/>
                </Transitions>
            </Setter>
        </Style>
        
        <Style Selector="Border.ImageButton">
            <Setter Property="Cursor" Value="Hand"></Setter>
            <Setter Property="Padding" Value="5"></Setter>
            <Setter Property="Background" Value="Transparent"></Setter>
        </Style>
        
        <Style Selector="Border.ImageButton:pointerover">
            <Setter Property="Background" Value="LightGray"></Setter>
        </Style>
    </Window.Styles>

    <Window.Resources>
        <StackPanel Background="Transparent" x:Key="SearchBible" MinWidth="640" Margin="20">
            <StackPanel Spacing="10" Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="20"
                    FontFamily="{StaticResource Poetsen}">
                    Kitab
                </TextBlock>
                <TextBlock Text="&#x9;" />

                <AutoCompleteBox
                    FontFamily="{StaticResource Poetsen}"
                    x:Name="autoCompleteBox"
                    VerticalAlignment="Bottom"
                    BorderThickness="0"
                    MinimumPrefixLength="0"
                    MaxDropDownHeight="300"
                    Width="200"
                    ItemsSource="{Binding BookList}"
                    Text="{Binding BibleInstances.BookNameText, Mode=TwoWay}"
                    SelectedItem="{Binding BibleInstances.BookName, Mode=TwoWay}">
                    <AutoCompleteBox.Styles>
                        <Style Selector="TextBox">
                            <Setter Property="Padding" Value="5,0,5,0" />
                            <Setter Property="VerticalContentAlignment" Value="Center" />
                        </Style>
                    </AutoCompleteBox.Styles>
                </AutoCompleteBox>
            </StackPanel>

            <!-- Book and Verse Number -->
            <StackPanel Margin="0 10 0 0" Spacing="10" MinHeight="100" Orientation="Horizontal"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                <TextBlock
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="20"
                    FontFamily="{StaticResource Poetsen}">
                    Pasal
                </TextBlock>

                <Border
                    Background="{Binding ToggleState.Target, Converter={StaticResource ActiveStateConverter}, ConverterParameter=pasal, TargetNullValue=Transparent}"
                    x:Name="pasalToggle"
                    Tag="pasal"
                    Cursor="Hand"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    BorderBrush="White"
                    BorderThickness="1"
                    Width="60" Height="60" CornerRadius="50">
                    <Interaction.Behaviors>
                        <EventTriggerBehavior EventName="PointerPressed" SourceObject="pasalToggle">
                            <InvokeCommandAction Command="{Binding TogglePasalAyat}" CommandParameter="pasal" />
                        </EventTriggerBehavior>
                    </Interaction.Behaviors>
                    <TextBlock
                        FontSize="30"
                        FontFamily="{StaticResource Poetsen}"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Text="{Binding ToggleState.PasalText}" />
                </Border>

                <!-- Tab -->
                <TextBlock Text="&#x9;" />

                <TextBlock
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="20"
                    FontFamily="{StaticResource Poetsen}">
                    Ayat
                </TextBlock>

                <Border
                    Background="{Binding ToggleState.Target, Converter={StaticResource ActiveStateConverter}, ConverterParameter=ayat, TargetNullValue=Transparent}"
                    x:Name="ayatToggle"
                    Tag="ayat"
                    Cursor="Hand"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    BorderBrush="White"
                    BorderThickness="1"
                    Width="60" Height="60" CornerRadius="50">
                    <Interaction.Behaviors>
                        <EventTriggerBehavior EventName="PointerPressed" SourceObject="ayatToggle">
                            <InvokeCommandAction Command="{Binding TogglePasalAyat}" CommandParameter="ayat" />
                        </EventTriggerBehavior>
                    </Interaction.Behaviors>
                    <TextBlock
                        FontSize="30"
                        FontFamily="{StaticResource Poetsen}"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Text="{Binding ToggleState.AyatText}" />
                </Border>
            </StackPanel>

            <ItemsControl ItemsSource="{Binding Numbers}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid
                            Columns="3"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="vm:NumberItemViewModel">
                        <Button
                            Cursor="Hand"
                            Margin="5"
                            CornerRadius="50"
                            IsEnabled="{Binding Value.Length, Converter={StaticResource IsNotEmptyConverter}}"
                            Command="{Binding ClickCommand}"
                            CommandParameter="{Binding Value}">
                            <Button.Styles>
                                <Style Selector="Button">
                                    <Setter Property="IsVisible"
                                            Value="{Binding ., Converter={StaticResource IsNotEmptyConverter}}" />
                                </Style>
                            </Button.Styles>
                            <Border
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Background="Transparent"
                                Width="40" Height="40" CornerRadius="50">
                                <TextBlock
                                    FontSize="20"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    FontFamily="{StaticResource Poetsen}"
                                    Text="{Binding Value}" />
                            </Border>
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <Button Margin="0 16 0 0"
                    Command="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType=dialogHost:DialogHost}, Path=CloseDialogCommand}">
                Tutup
            </Button>
        </StackPanel>
        
        <StackPanel Background="Transparent" x:Key="ChangeLogView" MinWidth="640" Margin="20">
            <views:ChangeLogView/>
        </StackPanel>
    </Window.Resources>

    <dialogHost:DialogHost
        DialogMargin="3"
        Background="#474747"
        dialogHost:DialogHostStyle.CornerRadius="10"
        IsOpen="{Binding IsLoading}"
        Identifier="MainDialogHost" CloseOnClickAway="True" DisableOpeningAnimation="True">
        <Grid RowDefinitions="Auto,Auto,*">
            <Border Grid.Row="0" BorderBrush="Black" BorderThickness="0, 0, 0, 1" Padding="10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width=".4*" /> <!-- 50% -->
                        <ColumnDefinition Width="1*" /> <!-- 50% -->
                        <ColumnDefinition Width=".4*" /> <!-- 50% -->
                    </Grid.ColumnDefinitions>
                    <Border Grid.Column="0" Padding="10">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center"
                                    Spacing="20">
                            <Border>
                                <Image x:Name="BibleImage"
                                       Source="/Assets/bookCW.png"
                                       Width="64" Height="64"
                                       Cursor="Hand"
                                       ToolTip.Tip="Buka Alkitab"
                                       ToolTip.ShowDelay="0"
                                       ToolTip.Placement="Bottom" />
                            </Border>
                            <Border HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock
                                    FontSize="30"
                                    FontFamily="{StaticResource Poetsen}"
                                    Text="Alkitab" />
                            </Border>
                        </StackPanel>
                    </Border>

                    <!-- Version -->
                    <Border Grid.Column="2">
                        <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
                            <TextBlock
                                VerticalAlignment="Center"
                                FontSize="20" FontFamily="{StaticResource Poetsen}">
                                v1.1
                            </TextBlock>
                            <Border>
                                <Image x:Name="InfoIcon"
                                       Source="/Assets/infoW.png"
                                       Width="40" Height="40"
                                       Cursor="Hand" />
                            </Border>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- Navigation Arrow -->
            <Border
                IsVisible="{Binding BibleInstances.SelectedBookName, Converter={StaticResource NavigationVisibility}}"
                Grid.Row="1" Margin="10" VerticalAlignment="Center" HorizontalAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <Border Cursor="Hand" x:Name="NavigationArrowLeft">
                        <Interaction.Behaviors>
                            <EventTriggerBehavior EventName="PointerPressed" SourceObject="NavigationArrowLeft">
                                <InvokeCommandAction Command="{Binding NavigateChapterCommand}">
                                    <InvokeCommandAction.CommandParameter>
                                        <MultiBinding Converter="{StaticResource MultiParamConverter}">
                                            <Binding Path="BibleInstances.SelectedBookName" />
                                            <Binding Path="ToggleState.Pasal" />
                                            <Binding Source="left" />
                                        </MultiBinding>
                                    </InvokeCommandAction.CommandParameter>
                                </InvokeCommandAction>
                            </EventTriggerBehavior>
                        </Interaction.Behaviors>
                        <TextBlock FontSize="24" FontWeight="Bold">←</TextBlock>
                    </Border>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontFamily="{StaticResource Poetsen}"
                                   Text="{Binding BibleInstances.SelectedBookName}" FontSize="20"
                                   VerticalAlignment="Center" />
                        <TextBlock FontFamily="{StaticResource Poetsen}" Text=" : " FontSize="20"
                                   VerticalAlignment="Center" />
                        <TextBlock FontFamily="{StaticResource Poetsen}" Text="{Binding ToggleState.Pasal}"
                                   FontSize="20" VerticalAlignment="Center" />
                    </StackPanel>
                    <Border Cursor="Hand" x:Name="NavigationArrowRight">
                        <Interaction.Behaviors>
                            <EventTriggerBehavior EventName="PointerPressed" SourceObject="NavigationArrowRight">
                                <InvokeCommandAction Command="{Binding NavigateChapterCommand}">
                                    <InvokeCommandAction.CommandParameter>
                                        <MultiBinding Converter="{StaticResource MultiParamConverter}">
                                            <Binding Path="BibleInstances.SelectedBookName" />
                                            <Binding Path="ToggleState.Pasal" />
                                            <Binding Source="right" />
                                        </MultiBinding>
                                    </InvokeCommandAction.CommandParameter>
                                </InvokeCommandAction>
                            </EventTriggerBehavior>
                        </Interaction.Behaviors>
                        <TextBlock FontSize="24" FontWeight="Bold">→</TextBlock>
                    </Border>
                </StackPanel>
            </Border>

            <Grid Grid.Row="2" ColumnDefinitions="*, Auto">
                <!-- Why use ScrollViewer when it already uses ListBox? -->
                <!-- The ScrollViewer enables the action of scroll to the index and make sure of it to be at the top of the list view -->
                <ScrollViewer x:Name="BibleScrollViewer"  Margin="100 40 50 40" Grid.Column="0"
                              VerticalScrollBarVisibility="Auto">
                    <ListBox SelectionChanged="ScrollBible_OnSelectionChanged" SelectionMode="Multiple, Toggle"
                             x:Name="ScrollBible"
                             Classes="ScrollBible" Background="Transparent"
                             ItemsSource="{Binding FilteredBible}">

                        <!-- Disables virtualization, StackPanel lets each item grow as tall as it needs, so text can wrap naturally  -->
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>

                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="10 0 0 0">
                                    <Grid ColumnDefinitions="Auto,Auto,*" VerticalAlignment="Bottom">
                                        <TextBlock Grid.Column="0" FontSize="18" Text="{Binding verse}" />
                                        <TextBlock Grid.Column="1" FontSize="18" Text=". " />
                                        <TextBlock Grid.Column="2"
                                                   FontFamily="{StaticResource NationalPark}"
                                                   FontSize="18"
                                                   TextWrapping="Wrap"
                                                   Text="{Binding text}" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </ScrollViewer>

                <Border VerticalAlignment="Top" Grid.Column="1"
                        Width="400" Height="300"
                        Background="#5A5A5A" CornerRadius="10" Margin="20">
                    <Border.Effect>
                        <DropShadowEffect Color="Black"
                                          BlurRadius="8"
                                          Opacity="0.4" />
                    </Border.Effect>
                    <Grid RowDefinitions="Auto, *">
                        <views:ToolBox Padding="20 20 20 0" Grid.Row="0" Height="{Binding IsToolBoxVisible, Converter={StaticResource ToolBoxConverter}}"/>
                        
                        <!-- <views:ChangeLogView Padding="20" Grid.Row="1"/> -->
                        <Grid Grid.Row="1">
                            <Border Padding="20">
                                <StackPanel Orientation="Vertical">
                                    <Border PointerPressed="BookmarkPanel_OnPointerPressed" Classes="ImageButton">
                                        <StackPanel Orientation="Horizontal" Spacing="5">
                                            <Border x:Name="BookmarkButton">
                                                <Image x:Name="BookmarkIcon"
                                                       Source="/Assets/bookmark-white.png"
                                                       Width="26"/>
                                            </Border>
                                            <TextBlock VerticalAlignment="Center" FontWeight="Light" FontFamily="{StaticResource Poetsen}"
                                                       FontSize="14">Lihat Pembatas Buku</TextBlock>
                                        </StackPanel>
                                    </Border>
                                    
                                    <Border Classes="ImageButton">
                                        <StackPanel Orientation="Horizontal" Spacing="5">
                                            <Border >
                                                <Image Source="/Assets/highlight-white.png"
                                                       Width="26"/>
                                            </Border>
                                            <TextBlock VerticalAlignment="Center" FontWeight="Light" FontFamily="{StaticResource Poetsen}"
                                                       FontSize="14">Lihat Daftar Sorotan</TextBlock>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Border>
                            
                            <Border x:Name="OverlayPanel"
                                    Background="Gray"
                                    Opacity="0.4"
                                    IsVisible="{Binding IsToolBoxVisible, Converter={StaticResource ToolBoxConverter}}"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Stretch"
                                    ZIndex="999">
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </dialogHost:DialogHost>

</Window>